From 32ac20b93a622b6fb0d0ee22362c18c21e4f65c5 Mon Sep 17 00:00:00 2001
From: Cameron Baird <cameronbaird@microsoft.com>
Date: Tue, 16 Apr 2024 22:24:51 +0000
Subject: [PATCH 1/4] CVE-2023-42821

---
 vendor/github.com/gomarkdown/markdown/parser/block.go    | 7 ++++++-
 vendor/github.com/gomarkdown/markdown/parser/citation.go | 5 +++++
 2 files changed, 11 insertions(+), 1 deletion(-)

diff --git a/vendor/github.com/gomarkdown/markdown/parser/block.go b/vendor/github.com/gomarkdown/markdown/parser/block.go
index a0b809915..54f6a237e 100644
--- a/vendor/github.com/gomarkdown/markdown/parser/block.go
+++ b/vendor/github.com/gomarkdown/markdown/parser/block.go
@@ -172,6 +172,11 @@ func (p *Parser) block(data []byte) {
 		// <div>
 		//     ...
 		// </div>
+
+		if len(data) == 0 {
+			continue
+		}
+
 		if data[0] == '<' {
 			if i := p.html(data, true); i > 0 {
 				data = data[i:]
@@ -376,7 +381,7 @@ func (p *Parser) addBlock(n ast.Node) ast.Node {
 }
 
 func (p *Parser) isPrefixHeading(data []byte) bool {
-	if data[0] != '#' {
+	if len(data) > 0 && data[0] != '#' {
 		return false
 	}
 
diff --git a/vendor/github.com/gomarkdown/markdown/parser/citation.go b/vendor/github.com/gomarkdown/markdown/parser/citation.go
index 8ea1fbeee..217d4def0 100644
--- a/vendor/github.com/gomarkdown/markdown/parser/citation.go
+++ b/vendor/github.com/gomarkdown/markdown/parser/citation.go
@@ -65,6 +65,11 @@ func citation(p *Parser, data []byte, offset int) (int, ast.Node) {
 		}
 
 		citeType := ast.CitationTypeInformative
+
+		if len(citation) < 2 {
+			continue
+		}
+
 		j = 1
 		switch citation[j] {
 		case '!':
-- 
2.33.8

