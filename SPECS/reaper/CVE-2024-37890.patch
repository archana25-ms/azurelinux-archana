From 355a396ccce875ea012a4ea8e6ab283bb575ba5b Mon Sep 17 00:00:00 2001
From: ABC <abc>
Date: Tue, 9 Jul 2024 16:48:16 +0000
Subject: [PATCH] Patching CVE-2024-37890.

Applying the patch for the 6.x versions from:
https://github.com/websockets/ws/commit/eeb76d313e2a00dd5247ca3597bba7877d064a63
---
 src/ui/node_modules/ws/lib/websocket-server.js | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/src/ui/node_modules/ws/lib/websocket-server.js b/src/ui/node_modules/ws/lib/websocket-server.js
index db02f4d0..b74eb1cf 100644
--- a/src/ui/node_modules/ws/lib/websocket-server.js
+++ b/src/ui/node_modules/ws/lib/websocket-server.js
@@ -186,12 +186,14 @@ class WebSocketServer extends EventEmitter {
       req.headers['sec-websocket-key'] !== undefined
         ? req.headers['sec-websocket-key'].trim()
         : false;
+    const upgrade = req.headers.upgrade;
     const version = +req.headers['sec-websocket-version'];
     const extensions = {};
 
     if (
       req.method !== 'GET' ||
-      req.headers.upgrade.toLowerCase() !== 'websocket' ||
+      upgrade === undefined ||
+      upgrade.toLowerCase() !== 'websocket' ||
       !key ||
       !keyRegex.test(key) ||
       (version !== 8 && version !== 13) ||
-- 
2.39.4

